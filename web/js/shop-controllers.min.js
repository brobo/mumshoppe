var app = angular.module('mumshoppe-shop', [
	'ui.router',
	'ui.bootstrap',
	'ajoslin.promise-tracker',
	'shop.partials',
	'controller.alerts',
	'controller.really',
	'service.alert',
	'service.really'
	]);

app.config(function($stateProvider, $urlRouterProvider, $httpProvider) {

	$stateProvider
		.state('index', {
			url: ''
		})
		.state('base', {
			templateUrl: 'base.html'
		})
		.state('base.home', {
			url: '/home',
			templateUrl: 'home.html',
			controller: 'homeController'
		});

		$httpProvider.defaults.post = {'Content-Type': 'application/x-www-form-urlencoded'};
		$httpProvider.defaults.put = {'Content-Type': 'application/x-www-form-urlencoded'};

});


angular.module('controller.alerts', [])
	.controller('AlertsController', ['$scope', 'AlertService', function($scope, AlertService) {
		$scope.closeAlert = AlertService.closeAlert;
	}]);
angular.module('controller.really', [])
	.controller('ReallyController', [
	'$scope',
	'$modalInstance',
	'promiseTracker',
	'data',
	'callback',
	function($scope, $modalInstance, promiseTracker, data, callback) {

		$scope.data = data;
		$scope.cancel = $modalInstance.dismiss;
		$scope.tracker = promiseTracker();

		$scope.confirm = function() {
			var promise = callback();
			if (promise.then) {
				var deferred = $scope.tracker.createPromise();
				promise.then($modalInstance.close, $modalInstance.dismiss).finally(deferred.resolve);
			} else {
				$modalInstance.close();
			}
		}
	}]);